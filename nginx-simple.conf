# Configuration Nginx simplifi√©e pour test
upstream api {
    server api:3002;
}

upstream backoffice {
    server backoffice:80;
}

upstream eboutique {
    server eboutique:80;
}

upstream jeroka-site {
    server jeroka-site:80;
}

# Serveur par d√©faut pour les tests
server {
    listen 80;
    server_name _;
    
    # Page d'accueil par d√©faut
    location / {
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Jeroka Xperience</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #0ea5e9; text-align: center; }
        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }
        .service { padding: 20px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        .service a { text-decoration: none; color: #0ea5e9; font-weight: bold; }
        .service a:hover { color: #d946ef; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ Jeroka Xperience</h1>
        <p style="text-align: center; color: #666;">L\'IA qui transforme votre PME en entreprise digitale performante</p>
        <div class="services">
            <div class="service">
                <h3>üìä Backoffice</h3>
                <a href="/backoffice/">Acc√©der au Backoffice</a>
            </div>
            <div class="service">
                <h3>üõí E-boutique</h3>
                <a href="/shop/">Acc√©der √† l\'E-boutique</a>
            </div>
            <div class="service">
                <h3>üåê Site Web</h3>
                <a href="/site/">Acc√©der au Site</a>
            </div>
            <div class="service">
                <h3>üîß API</h3>
                <a href="/api/health">V√©rifier l\'API</a>
            </div>
            <div class="service">
                <h3>üóÑÔ∏è Adminer</h3>
                <a href="http://51.38.185.108:8080">Gestion BDD</a>
            </div>
        </div>
    </div>
</body>
</html>';
        add_header Content-Type text/html;
    }
    
    # API
    location /api/ {
        proxy_pass http://api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Backoffice
    location /backoffice/ {
        proxy_pass http://backoffice/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # E-boutique
    location /shop/ {
        proxy_pass http://eboutique/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Site principal
    location /site/ {
        proxy_pass http://jeroka-site/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
