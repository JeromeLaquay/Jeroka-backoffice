<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©ploiement - Documentation Jeroka</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üìö Documentation Jeroka</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="api.html">API</a></li>
                <li><a href="deployment.html" class="active">D√©ploiement</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h1>üöÄ Guide de D√©ploiement</h1>
            <p>Instructions compl√®tes pour d√©ployer le syst√®me Jeroka</p>
        </div>

        <div class="content-section">
            <h2>Pr√©requis</h2>
            <ul>
                <li>Docker et Docker Compose install√©s</li>
                <li>Git pour cloner le repository</li>
                <li>Acc√®s √† un serveur (local ou cloud)</li>
                <li>Ports disponibles : 80, 443, 3000, 3001, 3002, 5432</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>Environnements de D√©ploiement</h2>
            <h3>D√©veloppement Local</h3>
            <div class="code-block">
                <pre><code># Cloner le repository
git clone [url-du-repository]
cd test-lq

# Lancer l'environnement de d√©veloppement
docker-compose -f docker-compose.local.yml up -d

# V√©rifier que tous les services sont d√©marr√©s
docker-compose ps</code></pre>
            </div>

            <h3>Production</h3>
            <div class="code-block">
                <pre><code># Lancer l'environnement de production
docker-compose -f docker-compose.prod.yml up -d

# V√©rifier les logs
docker-compose -f docker-compose.prod.yml logs -f</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Configuration des Services</h2>
            <h3>Variables d'Environnement</h3>
            <p>Cr√©ez un fichier <code>.env</code> √† la racine du projet :</p>
            <div class="code-block">
                <pre><code># Base de donn√©es
POSTGRES_DB=jeroka_db
POSTGRES_USER=jeroka_user
POSTGRES_PASSWORD=your_secure_password

# API
JWT_SECRET=your_jwt_secret_key
JWT_REFRESH_SECRET=your_refresh_secret_key
API_PORT=3000

# Frontend
BACKOFFICE_PORT=3001
EBOUTIQUE_PORT=3002
JEROKA_PORT=3003

# Nginx
NGINX_PORT=80
NGINX_SSL_PORT=443</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Services Docker</h2>
            <table>
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Port</th>
                        <th>Description</th>
                        <th>D√©pendances</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>postgres</td>
                        <td>5432</td>
                        <td>Base de donn√©es PostgreSQL</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>api-dashboard</td>
                        <td>3000</td>
                        <td>API Backend</td>
                        <td>postgres</td>
                    </tr>
                    <tr>
                        <td>backoffice</td>
                        <td>3001</td>
                        <td>Interface d'administration</td>
                        <td>api-dashboard</td>
                    </tr>
                    <tr>
                        <td>eboutique</td>
                        <td>3002</td>
                        <td>Site e-commerce</td>
                        <td>api-dashboard</td>
                    </tr>
                    <tr>
                        <td>jeroka</td>
                        <td>3003</td>
                        <td>Site vitrine</td>
                        <td>api-dashboard</td>
                    </tr>
                    <tr>
                        <td>nginx</td>
                        <td>80/443</td>
                        <td>Reverse proxy</td>
                        <td>Tous les services</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="content-section">
            <h2>Proc√©dure de D√©ploiement</h2>
            <h3>1. Pr√©paration du Serveur</h3>
            <div class="code-block">
                <pre><code># Mettre √† jour le syst√®me
sudo apt update && sudo apt upgrade -y

# Installer Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Installer Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose</code></pre>
            </div>

            <h3>2. D√©ploiement de l'Application</h3>
            <div class="code-block">
                <pre><code># Cloner le repository
git clone [url-du-repository]
cd test-lq

# Copier et configurer les variables d'environnement
cp .env.example .env
# √âditer le fichier .env avec vos valeurs

# Construire et lancer les services
docker-compose -f docker-compose.prod.yml up -d --build

# V√©rifier le statut des services
docker-compose -f docker-compose.prod.yml ps</code></pre>
            </div>

            <h3>3. Configuration de la Base de Donn√©es</h3>
            <div class="code-block">
                <pre><code># Ex√©cuter les migrations
docker-compose -f docker-compose.prod.yml exec api-dashboard npm run migrate

# Ex√©cuter les seeds (donn√©es de test)
docker-compose -f docker-compose.prod.yml exec api-dashboard npm run seed</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Configuration SSL/HTTPS</h2>
            <h3>Avec Let's Encrypt</h3>
            <div class="code-block">
                <pre><code># Installer Certbot
sudo apt install certbot python3-certbot-nginx

# Obtenir un certificat SSL
sudo certbot --nginx -d yourdomain.com

# Configurer le renouvellement automatique
sudo crontab -e
# Ajouter : 0 12 * * * /usr/bin/certbot renew --quiet</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Monitoring et Logs</h2>
            <h3>V√©rification des Logs</h3>
            <div class="code-block">
                <pre><code># Voir tous les logs
docker-compose -f docker-compose.prod.yml logs

# Voir les logs d'un service sp√©cifique
docker-compose -f docker-compose.prod.yml logs api-dashboard

# Suivre les logs en temps r√©el
docker-compose -f docker-compose.prod.yml logs -f</code></pre>
            </div>

            <h3>Monitoring des Ressources</h3>
            <div class="code-block">
                <pre><code># Voir l'utilisation des ressources
docker stats

# Voir l'espace disque utilis√©
docker system df

# Nettoyer les images inutilis√©es
docker system prune -a</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Sauvegarde et Restauration</h2>
            <h3>Sauvegarde de la Base de Donn√©es</h3>
            <div class="code-block">
                <pre><code># Cr√©er une sauvegarde
docker-compose -f docker-compose.prod.yml exec postgres pg_dump -U jeroka_user jeroka_db > backup_$(date +%Y%m%d_%H%M%S).sql

# Restaurer une sauvegarde
docker-compose -f docker-compose.prod.yml exec -T postgres psql -U jeroka_user jeroka_db < backup_file.sql</code></pre>
            </div>

            <h3>Sauvegarde des Fichiers</h3>
            <div class="code-block">
                <pre><code># Sauvegarder les uploads
tar -czf uploads_backup_$(date +%Y%m%d_%H%M%S).tar.gz uploads/

# Sauvegarder la configuration
tar -czf config_backup_$(date +%Y%m%d_%H%M%S).tar.gz .env docker-compose.prod.yml nginx.conf</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>Mise √† Jour</h2>
            <h3>Proc√©dure de Mise √† Jour</h3>
            <div class="code-block">
                <pre><code># 1. Sauvegarder la base de donn√©es
docker-compose -f docker-compose.prod.yml exec postgres pg_dump -U jeroka_user jeroka_db > backup_before_update.sql

# 2. Arr√™ter les services
docker-compose -f docker-compose.prod.yml down

# 3. R√©cup√©rer les derni√®res modifications
git pull origin main

# 4. Reconstruire et relancer
docker-compose -f docker-compose.prod.yml up -d --build

# 5. Ex√©cuter les migrations si n√©cessaire
docker-compose -f docker-compose.prod.yml exec api-dashboard npm run migrate</code></pre>
            </div>
        </div>

        <div class="content-section">
            <h2>D√©pannage</h2>
            <h3>Probl√®mes Courants</h3>
            <ul>
                <li><strong>Service ne d√©marre pas</strong> : V√©rifier les logs avec <code>docker-compose logs [service]</code></li>
                <li><strong>Erreur de connexion √† la base</strong> : V√©rifier que PostgreSQL est d√©marr√© et accessible</li>
                <li><strong>Port d√©j√† utilis√©</strong> : Changer le port dans docker-compose.yml ou arr√™ter le service qui utilise le port</li>
                <li><strong>Probl√®me de permissions</strong> : V√©rifier les permissions des volumes Docker</li>
            </ul>

            <h3>Commandes Utiles</h3>
            <div class="code-block">
                <pre><code># Red√©marrer un service
docker-compose -f docker-compose.prod.yml restart [service]

# Reconstruire un service
docker-compose -f docker-compose.prod.yml up -d --build [service]

# Acc√©der au shell d'un conteneur
docker-compose -f docker-compose.prod.yml exec [service] sh

# Voir les processus en cours
docker-compose -f docker-compose.prod.yml top</code></pre>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Jeroka - Documentation Technique</p>
    </footer>
</body>
</html>
