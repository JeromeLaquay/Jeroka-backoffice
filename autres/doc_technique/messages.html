<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Messages - Documentation Jeroka</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üìö Documentation Jeroka</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="modules.html">Modules</a></li>
                <li><a href="api.html">API</a></li>
                <li><a href="deployment.html">D√©ploiement</a></li>
                <li><a href="messages.html" class="active">Messages</a></li>
                <li><a href="factures.html">Factures</a></li>
                <li><a href="devis.html">Devis</a></li>
            </ul>
        </nav>
        <button class="theme-toggle" onclick="toggleTheme()" title="Basculer le th√®me">
            <span id="theme-icon">üåô</span>
        </button>
    </header>

    <main class="container">
        <div class="page-header">
            <h1>üí¨ Module Gestion des Messages</h1>
            <p>Module intelligent de gestion des messages avec g√©n√©ration automatique de r√©ponses par IA</p>
        </div>

        <div class="content-section">
            <h2>Vue d'ensemble</h2>
            <p>Le module Messages de Jeroka est un syst√®me avanc√© de gestion des communications clients qui int√®gre l'intelligence artificielle pour automatiser et optimiser les r√©ponses. Il permet de recevoir, classer, traiter et r√©pondre aux messages provenant du site web ou d'autres sources.</p>
            
            <div class="module-card">
                <h3>Fonctionnalit√©s principales</h3>
                <ul>
                    <li><strong>R√©ception des messages</strong> - Collecte automatique depuis le site web</li>
                    <li><strong>Classification intelligente</strong> - Cat√©gorisation par type et priorit√©</li>
                    <li><strong>G√©n√©ration IA de r√©ponses</strong> - Brouillons automatiques avec ChatGPT</li>
                    <li><strong>Gestion des statuts</strong> - Nouveau, lu, r√©pondu, archiv√©</li>
                    <li><strong>Filtres et recherche</strong> - Recherche multicrit√®res avanc√©e</li>
                    <li><strong>Notifications temps r√©el</strong> - Alertes instantan√©es</li>
                    <li><strong>Historique complet</strong> - Suivi des √©changes clients</li>
                    <li><strong>Multi-tenant</strong> - Isolation des donn√©es par entreprise</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Architecture du Module</h2>
            <div class="module-card">
                <h3>Composants principaux</h3>
                <ul>
                    <li><strong>MessageService</strong> - Logique m√©tier et gestion des donn√©es</li>
                    <li><strong>MessageIAService</strong> - Int√©gration avec l'IA pour g√©n√©ration de r√©ponses</li>
                    <li><strong>MessageRepository</strong> - Acc√®s aux donn√©es et requ√™tes</li>
                    <li><strong>Validation</strong> - Contr√¥les de donn√©es et s√©curit√©</li>
                    <li><strong>Middleware d'authentification</strong> - S√©curisation des endpoints</li>
                </ul>

                <h3>Technologies utilis√©es</h3>
                <ul>
                    <li><strong>Backend</strong> - Node.js, Express.js, TypeScript</li>
                    <li><strong>Base de donn√©es</strong> - PostgreSQL avec requ√™tes optimis√©es</li>
                    <li><strong>IA</strong> - OpenAI ChatGPT API (GPT-3.5-turbo)</li>
                    <li><strong>Authentification</strong> - JWT avec middleware de v√©rification</li>
                    <li><strong>Validation</strong> - Joi pour la validation des donn√©es</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>API Endpoints</h2>
            <div class="module-card">
                <h3>Gestion des Messages</h3>
                <div class="code-block">
                    <h4>Endpoints principaux</h4>
                    <pre><code>POST   /api/v1/messages              - Cr√©er un nouveau message
GET    /api/v1/messages              - Liste des messages (avec filtres)
GET    /api/v1/messages/:id          - D√©tails d'un message
PUT    /api/v1/messages/:id          - Modifier un message
DELETE /api/v1/messages/:id          - Supprimer un message
GET    /api/v1/messages/stats        - Statistiques des messages</code></pre>
                </div>

                <h3>Gestion des Statuts</h3>
                <div class="code-block">
                    <h4>Endpoints de statut</h4>
                    <pre><code>POST   /api/v1/messages/:id/mark-read    - Marquer comme lu
POST   /api/v1/messages/:id/mark-unread  - Marquer comme non lu
POST   /api/v1/messages/mark-all-read    - Marquer tous comme lus</code></pre>
                </div>

                <h3>Int√©gration IA</h3>
                <div class="code-block">
                    <h4>G√©n√©ration de r√©ponses IA</h4>
                    <pre><code>POST   /api/v1/messages/:id/ai-draft     - G√©n√©rer brouillon IA</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Int√©gration Intelligence Artificielle</h2>
            <div class="module-card">
                <h3>Service IA Modulaire</h3>
                <p>Le syst√®me utilise une architecture modulaire pour l'IA, permettant de supporter diff√©rents fournisseurs :</p>
                <ul>
                    <li><strong>ChatGPT (OpenAI)</strong> - Fournisseur principal actuel</li>
                    <li><strong>Claude (Anthropic)</strong> - Support pr√©vu</li>
                    <li><strong>Mod√®les locaux</strong> - Support pour d√©ploiements priv√©s</li>
                </ul>

                <h3>G√©n√©ration de Brouillons</h3>
                <div class="code-block">
                    <h4>Options de g√©n√©ration</h4>
                    <pre><code>{
  "tone": "professionnel" | "amical" | "formel" | "concis",
  "language": "fr" | "en"
}</code></pre>
                </div>

                <h3>Processus de g√©n√©ration</h3>
                <ol>
                    <li><strong>R√©cup√©ration du message</strong> - Lecture du message original</li>
                    <li><strong>R√©cup√©ration des infos entreprise</strong> - Contexte de l'entreprise</li>
                    <li><strong>Construction du prompt</strong> - G√©n√©ration du prompt personnalis√©</li>
                    <li><strong>Appel √† l'IA</strong> - G√©n√©ration de la r√©ponse</li>
                    <li><strong>Retour du brouillon</strong> - R√©ponse pr√™te √† √™tre personnalis√©e</li>
                </ol>
            </div>
        </div>

        <div class="content-section">
            <h2>Structure des Donn√©es</h2>
            <div class="module-card">
                <h3>Mod√®le de Message</h3>
                <div class="code-block">
                    <h4>Structure compl√®te</h4>
                    <pre><code>{
  "id": "uuid",
  "first_name": "string",
  "last_name": "string", 
  "email": "string",
  "phone": "string",
  "company": "string",
  "subject": "string",
  "message": "string",
  "status": "new" | "read" | "replied" | "archived",
  "priority": "low" | "medium" | "high",
  "source": "website" | "email" | "phone",
  "tags": ["string"],
  "company_id": "uuid",
  "read_at": "datetime",
  "created_at": "datetime",
  "updated_at": "datetime"
}</code></pre>
                </div>

                <h3>Statistiques</h3>
                <div class="code-block">
                    <h4>Donn√©es de statistiques</h4>
                    <pre><code>{
  "total": "number",
  "new": "number",
  "read": "number", 
  "replied": "number",
  "archived": "number",
  "byPriority": {
    "low": "number",
    "medium": "number", 
    "high": "number"
  },
  "bySource": {
    "website": "number",
    "email": "number",
    "phone": "number"
  }
}</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Filtres et Recherche</h2>
            <div class="module-card">
                <h3>Param√®tres de filtrage</h3>
                <div class="code-block">
                    <h4>Query parameters support√©s</h4>
                    <pre><code>GET /api/v1/messages?
  page=1&
  limit=10&
  status=new&
  priority=high&
  source=website&
  search=terme&
  dateFrom=2024-01-01&
  dateTo=2024-12-31&
  tags=urgent,important</code></pre>
                </div>

                <h3>Fonctionnalit√©s de recherche</h3>
                <ul>
                    <li><strong>Recherche textuelle</strong> - Dans le contenu, sujet, nom</li>
                    <li><strong>Filtres par statut</strong> - Nouveau, lu, r√©pondu, archiv√©</li>
                    <li><strong>Filtres par priorit√©</strong> - Basse, moyenne, haute</li>
                    <li><strong>Filtres par source</strong> - Site web, email, t√©l√©phone</li>
                    <li><strong>Filtres par date</strong> - P√©riode personnalisable</li>
                    <li><strong>Filtres par tags</strong> - √âtiquettes personnalis√©es</li>
                    <li><strong>Pagination</strong> - Navigation par pages</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>S√©curit√© et Authentification</h2>
            <div class="module-card">
                <h3>M√©canismes de s√©curit√©</h3>
                <ul>
                    <li><strong>Authentification JWT</strong> - Tokens s√©curis√©s pour l'acc√®s</li>
                    <li><strong>Isolation multi-tenant</strong> - Donn√©es s√©par√©es par entreprise</li>
                    <li><strong>Validation des donn√©es</strong> - Contr√¥les stricts sur les entr√©es</li>
                    <li><strong>Logs d'audit</strong> - Tra√ßabilit√© des actions</li>
                    <li><strong>Rate limiting</strong> - Protection contre les abus</li>
                </ul>

                <h3>Permissions</h3>
                <ul>
                    <li><strong>Lecture</strong> - Consultation des messages de l'entreprise</li>
                    <li><strong>√âcriture</strong> - Modification et cr√©ation de messages</li>
                    <li><strong>Suppression</strong> - Suppression des messages (admin)</li>
                    <li><strong>IA</strong> - G√©n√©ration de r√©ponses IA</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Exemples d'utilisation</h2>
            <div class="module-card">
                <h3>Cr√©ation d'un message</h3>
                <div class="code-block">
                    <h4>Requ√™te POST</h4>
                    <pre><code>POST /api/v1/messages
Content-Type: application/json

{
  "firstName": "Jean",
  "lastName": "Dupont", 
  "email": "jean.dupont@example.com",
  "phone": "+33123456789",
  "company": "Entreprise ABC",
  "subject": "Demande de devis",
  "message": "Bonjour, je souhaiterais obtenir un devis...",
  "priority": "medium",
  "source": "website",
  "tags": ["devis", "nouveau-client"]
}</code></pre>
                </div>

                <h3>G√©n√©ration de r√©ponse IA</h3>
                <div class="code-block">
                    <h4>Requ√™te POST</h4>
                    <pre><code>POST /api/v1/messages/123/ai-draft
Content-Type: application/json

{
  "tone": "professionnel",
  "language": "fr"
}</code></pre>
                </div>

                <h3>R√©ponse IA</h3>
                <div class="code-block">
                    <h4>R√©ponse g√©n√©r√©e</h4>
                    <pre><code>{
  "success": true,
  "data": {
    "draft": "Bonjour M. Dupont,\n\nMerci pour votre message...",
    "messageId": "123",
    "generatedAt": "2024-01-15T10:30:00Z",
    "options": {
      "tone": "professionnel",
      "language": "fr"
    },
    "provider": "chatgpt"
  },
  "message": "Brouillon IA g√©n√©r√© avec succ√®s"
}</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Configuration et D√©ploiement</h2>
            <div class="module-card">
                <h3>Variables d'environnement</h3>
                <div class="code-block">
                    <h4>Configuration requise</h4>
                    <pre><code># Base de donn√©es
DATABASE_URL=postgresql://user:pass@localhost:5432/jeroka

# OpenAI API
OPENAI_API_KEY=sk-...

# JWT
JWT_SECRET=your-secret-key

# Environnement
NODE_ENV=production</code></pre>
                </div>

                <h3>D√©pendances</h3>
                <ul>
                    <li><strong>express</strong> - Framework web</li>
                    <li><strong>jsonwebtoken</strong> - Gestion JWT</li>
                    <li><strong>joi</strong> - Validation des donn√©es</li>
                    <li><strong>pg</strong> - Client PostgreSQL</li>
                    <li><strong>openai</strong> - SDK OpenAI</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Monitoring et Logs</h2>
            <div class="module-card">
                <h3>M√©triques importantes</h3>
                <ul>
                    <li><strong>Volume de messages</strong> - Nombre de messages re√ßus par jour</li>
                    <li><strong>Temps de r√©ponse</strong> - D√©lai moyen de traitement</li>
                    <li><strong>Taux d'utilisation IA</strong> - Pourcentage de r√©ponses g√©n√©r√©es</li>
                    <li><strong>Erreurs API</strong> - Taux d'√©chec des appels IA</li>
                    <li><strong>Performance base</strong> - Temps de requ√™te DB</li>
                </ul>

                <h3>Logs d'audit</h3>
                <ul>
                    <li><strong>Cr√©ation de messages</strong> - Tra√ßabilit√© des nouveaux messages</li>
                    <li><strong>G√©n√©ration IA</strong> - Logs des appels √† l'API OpenAI</li>
                    <li><strong>Modifications</strong> - Historique des changements</li>
                    <li><strong>Erreurs</strong> - Logs d'erreur d√©taill√©s</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Jeroka - Documentation Technique</p>
    </footer>

    <script>
        // Gestion du th√®me
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialiser le th√®me au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
            } else {
                themeIcon.textContent = 'üåô';
            }
        });
    </script>
</body>
</html>

