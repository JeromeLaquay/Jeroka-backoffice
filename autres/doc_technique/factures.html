<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Factures - Documentation Jeroka</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üìö Documentation Jeroka</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="modules.html">Modules</a></li>
                <li><a href="api.html">API</a></li>
                <li><a href="deployment.html">D√©ploiement</a></li>
                <li><a href="messages.html">Messages</a></li>
                <li><a href="factures.html" class="active">Factures</a></li>
                <li><a href="devis.html">Devis</a></li>
            </ul>
        </nav>
        <button class="theme-toggle" onclick="toggleTheme()" title="Basculer le th√®me">
            <span id="theme-icon">üåô</span>
        </button>
    </header>

    <main class="container">
        <div class="page-header">
            <h1>üßæ Module Gestion des Factures</h1>
            <p>Syst√®me complet de facturation avec g√©n√©ration automatique, suivi des paiements et relances</p>
        </div>

        <div class="content-section">
            <h2>Vue d'ensemble</h2>
            <p>Le module Factures de Jeroka est un syst√®me de facturation professionnel qui permet de cr√©er, g√©rer et suivre les factures de mani√®re automatis√©e. Il int√®gre la g√©n√©ration de PDF, l'envoi par email, le suivi des paiements et les relances automatiques.</p>
            
            <div class="module-card">
                <h3>Fonctionnalit√©s principales</h3>
                <ul>
                    <li><strong>G√©n√©ration automatique</strong> - Cr√©ation depuis les devis accept√©s</li>
                    <li><strong>Num√©rotation s√©quentielle</strong> - Syst√®me de num√©ros personnalisable</li>
                    <li><strong>Calculs automatiques</strong> - TVA, remises, totaux</li>
                    <li><strong>G√©n√©ration PDF</strong> - Factures au format professionnel</li>
                    <li><strong>Envoi par email</strong> - Envoi automatique aux clients</li>
                    <li><strong>Suivi des paiements</strong> - Gestion des √©ch√©ances et r√®glements</li>
                    <li><strong>Relances automatiques</strong> - Syst√®me de relance configurable</li>
                    <li><strong>Export comptable</strong> - Int√©gration avec logiciels comptables</li>
                    <li><strong>Statistiques avanc√©es</strong> - Tableaux de bord financiers</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Architecture du Module</h2>
            <div class="module-card">
                <h3>Composants principaux</h3>
                <ul>
                    <li><strong>InvoiceService</strong> - Logique m√©tier et gestion des factures</li>
                    <li><strong>PDFGenerator</strong> - G√©n√©ration des factures en PDF</li>
                    <li><strong>EmailService</strong> - Envoi automatique des factures</li>
                    <li><strong>PaymentTracker</strong> - Suivi des paiements et √©ch√©ances</li>
                    <li><strong>ReminderService</strong> - Syst√®me de relances automatiques</li>
                    <li><strong>AccountingExport</strong> - Export vers syst√®mes comptables</li>
                </ul>

                <h3>Technologies utilis√©es</h3>
                <ul>
                    <li><strong>Backend</strong> - Node.js, Express.js, TypeScript</li>
                    <li><strong>Base de donn√©es</strong> - PostgreSQL avec contraintes d'int√©grit√©</li>
                    <li><strong>PDF</strong> - Puppeteer ou PDFKit pour g√©n√©ration</li>
                    <li><strong>Email</strong> - SendGrid ou Nodemailer</li>
                    <li><strong>Templates</strong> - Handlebars pour personnalisation</li>
                    <li><strong>Authentification</strong> - JWT avec permissions granulaires</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>API Endpoints</h2>
            <div class="module-card">
                <h3>Gestion des Factures</h3>
                <div class="code-block">
                    <h4>Endpoints principaux</h4>
                    <pre><code>GET    /api/v1/invoices              - Liste des factures (avec filtres)
POST   /api/v1/invoices              - Cr√©er une nouvelle facture
GET    /api/v1/invoices/:id          - D√©tails d'une facture
PUT    /api/v1/invoices/:id          - Modifier une facture
DELETE /api/v1/invoices/:id          - Supprimer une facture
GET    /api/v1/invoices/stats        - Statistiques des factures</code></pre>
                </div>

                <h3>Gestion des Statuts</h3>
                <div class="code-block">
                    <h4>Endpoints de statut</h4>
                    <pre><code>PUT    /api/v1/invoices/:id/status   - Modifier le statut
POST   /api/v1/invoices/:id/send     - Envoyer la facture par email
GET    /api/v1/invoices/:id/pdf      - T√©l√©charger le PDF</code></pre>
                </div>

                <h3>Gestion des Paiements</h3>
                <div class="code-block">
                    <h4>Endpoints de paiement</h4>
                    <pre><code>POST   /api/v1/invoices/:id/pay      - Enregistrer un paiement
GET    /api/v1/invoices/:id/payments - Historique des paiements
POST   /api/v1/invoices/:id/remind   - Envoyer une relance</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Structure des Donn√©es</h2>
            <div class="module-card">
                <h3>Mod√®le de Facture</h3>
                <div class="code-block">
                    <h4>Structure compl√®te</h4>
                    <pre><code>{
  "id": "uuid",
  "invoiceNumber": "INV-2024-001",
  "clientId": "uuid",
  "clientName": "string",
  "clientEmail": "string",
  "clientAddress": {
    "street": "string",
    "city": "string",
    "postalCode": "string",
    "country": "string"
  },
  "status": "draft" | "sent" | "paid" | "overdue" | "cancelled",
  "issueDate": "date",
  "dueDate": "date",
  "paidDate": "date",
  "items": [
    {
      "id": "uuid",
      "description": "string",
      "quantity": "number",
      "unitPrice": "number",
      "total": "number",
      "taxRate": "number"
    }
  ],
  "subtotal": "number",
  "taxAmount": "number",
  "total": "number",
  "notes": "string",
  "companyId": "uuid",
  "createdAt": "datetime",
  "updatedAt": "datetime"
}</code></pre>
                </div>

                <h3>Mod√®le de Paiement</h3>
                <div class="code-block">
                    <h4>Structure de paiement</h4>
                    <pre><code>{
  "id": "uuid",
  "invoiceId": "uuid",
  "amount": "number",
  "paymentDate": "date",
  "paymentMethod": "bank_transfer" | "card" | "cash" | "check",
  "reference": "string",
  "notes": "string",
  "createdAt": "datetime"
}</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Workflow de Facturation</h2>
            <div class="module-card">
                <h3>Processus complet</h3>
                <ol>
                    <li><strong>Cr√©ation</strong> - G√©n√©ration depuis devis ou cr√©ation manuelle</li>
                    <li><strong>Validation</strong> - V√©rification des donn√©es et calculs</li>
                    <li><strong>G√©n√©ration PDF</strong> - Cr√©ation du document final</li>
                    <li><strong>Envoi</strong> - Transmission par email au client</li>
                    <li><strong>Suivi</strong> - Monitoring des √©ch√©ances</li>
                    <li><strong>Paiement</strong> - Enregistrement des r√®glements</li>
                    <li><strong>Relance</strong> - Envoi automatique si retard</li>
                    <li><strong>Archivage</strong> - Conservation des documents</li>
                </ol>

                <h3>Statuts des Factures</h3>
                <ul>
                    <li><strong>Draft</strong> - Brouillon en cours de cr√©ation</li>
                    <li><strong>Sent</strong> - Envoy√©e au client</li>
                    <li><strong>Paid</strong> - Paiement re√ßu</li>
                    <li><strong>Overdue</strong> - En retard de paiement</li>
                    <li><strong>Cancelled</strong> - Annul√©e</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>G√©n√©ration PDF</h2>
            <div class="module-card">
                <h3>Fonctionnalit√©s PDF</h3>
                <ul>
                    <li><strong>Templates personnalisables</strong> - Design adapt√© √† l'entreprise</li>
                    <li><strong>Logo et branding</strong> - Int√©gration de l'identit√© visuelle</li>
                    <li><strong>Mise en page responsive</strong> - Adaptation automatique</li>
                    <li><strong>Codes-barres</strong> - QR codes pour paiement</li>
                    <li><strong>Signature √©lectronique</strong> - Validation num√©rique</li>
                    <li><strong>Filigrane</strong> - Protection contre la contrefa√ßon</li>
                </ul>

                <h3>Configuration des Templates</h3>
                <div class="code-block">
                    <h4>Structure de template</h4>
                    <pre><code>{
  "header": {
    "logo": "url",
    "companyName": "string",
    "address": "object",
    "contact": "object"
  },
  "client": {
    "name": "string",
    "address": "object"
  },
  "invoice": {
    "number": "string",
    "date": "date",
    "dueDate": "date"
  },
  "items": "array",
  "totals": {
    "subtotal": "number",
    "tax": "number",
    "total": "number"
  },
  "footer": {
    "notes": "string",
    "paymentTerms": "string"
  }
}</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Syst√®me de Relances</h2>
            <div class="module-card">
                <h3>Configuration des Relances</h3>
                <ul>
                    <li><strong>Relances automatiques</strong> - D√©clenchement par √©ch√©ance</li>
                    <li><strong>√âchelons personnalisables</strong> - J+7, J+15, J+30, etc.</li>
                    <li><strong>Templates de relance</strong> - Messages adapt√©s au d√©lai</li>
                    <li><strong>Escalade</strong> - Relances de plus en plus fermes</li>
                    <li><strong>Exclusions</strong> - Clients exempt√©s de relances</li>
                    <li><strong>Pause automatique</strong> - Arr√™t si paiement partiel</li>
                </ul>

                <h3>Types de Relances</h3>
                <ul>
                    <li><strong>Courtoise</strong> - Rappel amical (J+7)</li>
                    <li><strong>Ferme</strong> - Demande de r√®glement (J+15)</li>
                    <li><strong>Mise en demeure</strong> - Formalisation (J+30)</li>
                    <li><strong>Recouvrement</strong> - Transmission √† un tiers (J+60)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Statistiques et Reporting</h2>
            <div class="module-card">
                <h3>M√©triques financi√®res</h3>
                <div class="code-block">
                    <h4>Donn√©es de statistiques</h4>
                    <pre><code>{
  "total": "number",
  "paid": "number",
  "pending": "number",
  "overdue": "number",
  "totalRevenue": "number",
  "averageInvoice": "number",
  "paymentRate": "number",
  "averagePaymentTime": "number",
  "byMonth": [
    {
      "month": "string",
      "count": "number",
      "amount": "number"
    }
  ],
  "byClient": [
    {
      "clientId": "uuid",
      "clientName": "string",
      "count": "number",
      "amount": "number"
    }
  ]
}</code></pre>
                </div>

                <h3>Tableaux de bord</h3>
                <ul>
                    <li><strong>Vue d'ensemble</strong> - KPIs principaux</li>
                    <li><strong>√âvolution mensuelle</strong> - Graphiques de tendance</li>
                    <li><strong>Top clients</strong> - Classement par CA</li>
                    <li><strong>Retards de paiement</strong> - Factures en souffrance</li>
                    <li><strong>Pr√©visions</strong> - Estimations de tr√©sorerie</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Int√©grations Comptables</h2>
            <div class="module-card">
                <h3>Formats d'export</h3>
                <ul>
                    <li><strong>FEC (Fichier des √âcritures Comptables)</strong> - Obligatoire en France</li>
                    <li><strong>CSV/Excel</strong> - Export g√©n√©rique</li>
                    <li><strong>XML</strong> - Format structur√©</li>
                    <li><strong>JSON</strong> - API d'int√©gration</li>
                </ul>

                <h3>Logiciels compatibles</h3>
                <ul>
                    <li><strong>Sage</strong> - Import automatique</li>
                    <li><strong>Ciel</strong> - Synchronisation</li>
                    <li><strong>EBP</strong> - Export natif</li>
                    <li><strong>QuickBooks</strong> - Int√©gration API</li>
                    <li><strong>Xero</strong> - Connecteur d√©di√©</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Exemples d'utilisation</h2>
            <div class="module-card">
                <h3>Cr√©ation d'une facture</h3>
                <div class="code-block">
                    <h4>Requ√™te POST</h4>
                    <pre><code>POST /api/v1/invoices
Content-Type: application/json

{
  "clientId": "uuid",
  "dueDate": "2024-02-15",
  "items": [
    {
      "description": "Service de d√©veloppement",
      "quantity": 1,
      "unitPrice": 240.00,
      "taxRate": 20
    }
  ],
  "notes": "Facture pour services de d√©veloppement web"
}</code></pre>
                </div>

                <h3>Enregistrement d'un paiement</h3>
                <div class="code-block">
                    <h4>Requ√™te POST</h4>
                    <pre><code>POST /api/v1/invoices/123/pay
Content-Type: application/json

{
  "amount": 288.00,
  "paymentDate": "2024-01-20",
  "paymentMethod": "bank_transfer",
  "reference": "VIR-2024-001",
  "notes": "Virement bancaire re√ßu"
}</code></pre>
                </div>

                <h3>Envoi d'une relance</h3>
                <div class="code-block">
                    <h4>Requ√™te POST</h4>
                    <pre><code>POST /api/v1/invoices/123/remind
Content-Type: application/json

{
  "type": "courtoise",
  "message": "Rappel amical de votre facture en retard"
}</code></pre>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>S√©curit√© et Conformit√©</h2>
            <div class="module-card">
                <h3>Exigences l√©gales</h3>
                <ul>
                    <li><strong>Num√©rotation s√©quentielle</strong> - Obligation fran√ßaise</li>
                    <li><strong>Conservation 10 ans</strong> - Archivage l√©gal</li>
                    <li><strong>Int√©grit√© des donn√©es</strong> - Protection contre modification</li>
                    <li><strong>Tra√ßabilit√©</strong> - Logs d'audit complets</li>
                    <li><strong>RGPD</strong> - Protection des donn√©es clients</li>
                </ul>

                <h3>M√©canismes de s√©curit√©</h3>
                <ul>
                    <li><strong>Chiffrement</strong> - Donn√©es sensibles prot√©g√©es</li>
                    <li><strong>Authentification forte</strong> - 2FA pour les acc√®s admin</li>
                    <li><strong>Permissions granulaires</strong> - Contr√¥le d'acc√®s fin</li>
                    <li><strong>Sauvegarde automatique</strong> - Protection contre perte</li>
                    <li><strong>Monitoring</strong> - D√©tection d'anomalies</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Configuration et D√©ploiement</h2>
            <div class="module-card">
                <h3>Variables d'environnement</h3>
                <div class="code-block">
                    <h4>Configuration requise</h4>
                    <pre><code># Base de donn√©es
DATABASE_URL=postgresql://user:pass@localhost:5432/jeroka

# Email
SENDGRID_API_KEY=SG...
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=user@domain.com
SMTP_PASS=password

# PDF
PDF_TEMPLATE_PATH=/templates/invoice.hbs
PDF_OUTPUT_PATH=/uploads/invoices

# JWT
JWT_SECRET=your-secret-key

# Environnement
NODE_ENV=production</code></pre>
                </div>

                <h3>D√©pendances</h3>
                <ul>
                    <li><strong>express</strong> - Framework web</li>
                    <li><strong>puppeteer</strong> - G√©n√©ration PDF</li>
                    <li><strong>handlebars</strong> - Templates</li>
                    <li><strong>sendgrid</strong> - Envoi d'emails</li>
                    <li><strong>jsonwebtoken</strong> - Authentification</li>
                    <li><strong>joi</strong> - Validation</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Jeroka - Documentation Technique</p>
    </footer>

    <script>
        // Gestion du th√®me
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialiser le th√®me au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
            } else {
                themeIcon.textContent = 'üåô';
            }
        });
    </script>
</body>
</html>

